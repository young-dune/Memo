import java.util.Scanner;

public class Project1 {
    int historyBufferSize = 10;
    String[] historyBuffer = new String[historyBufferSize];
    int historyIndex = 0;
    String command ="";

    public static void main(String[] args) {
        Project1 jshell = new Project1();
        jshell.run();
    }

    void run() {
        Scanner scanner = new Scanner(System.in);

        while (true) {
            System.out.println("jshell> ");
            String userInput = scanner.nextLine();

            if (userInput.charAt(0) == '/') {
                if (userInput.equals("/help")) {
                    displayHelp();
                } else if (userInput.equals("/history")) {
                    displayHistory(userInput);
                    historyBuffer[historyIndex] = command;
                    historyIndex ++;
                } else if (userInput.equals("/list")) {
                    displayList(userInput);
                } else if (userInput.equals("/!")) {
                    displayExecute();
                } else if (userInput.equals("/exit")) {
                    exitProgram();
                } else {
                    System.out.println("Invalid command: " + userInput + "\nType /help for help.");
                }
            } else {
                addToList(userInput);
                System.out.println("Running" + "'" + userInput + "'");
            }
        }
    }
    void displayHistory(String command) {
        historyBuffer[historyIndex] = command;
        for (int j = 0; j < historyIndex; j++) {
            if (historyBuffer[j].charAt(0) == '/') {
                System.out.println(historyBuffer[j]);
            }
        }
    }

    void displayHelp() { //구현완료
        System.out.println("Type a Java language expression, statement, or declaration.");
        System.out.println("Or type one of the following commands:");
        System.out.println("/list: list the source you have typed.");
        System.out.println("/exit: exit the jshell tool");
        System.out.println("/history: history of what you have typed.");
        System.out.println("/!: rerun last snippet.");
    }

    void addToList(String command) {
        historyBuffer[historyIndex] = command;
        historyIndex = (historyIndex + 1) % historyBufferSize;
    }

    void displayList(String userInput) {
        for (int i = 0; i < historyBufferSize; i++) {
            int index = (historyIndex + i) % historyBufferSize;
            if (historyBuffer[index] != null && historyBuffer[index].charAt(0) !='/') {
                System.out.println((i - 6) + ":" + historyBuffer[index]);
            }
        }
    }

    void displayExecute() {
        int lastIndex = (historyIndex - 1 + historyBufferSize) % historyBufferSize;
        String lastCommand = historyBuffer[lastIndex];
        if (lastCommand != null && lastCommand.charAt(0) == '/') {
            System.out.println("Running '" + lastCommand + "'.");
        } else {
            System.out.println("Re-Running '" + lastCommand + "'");
        }
    }

    void exitProgram(){ //구현완료
        System.out.println("Goodbye.");
        System.exit(0);
    }
}

